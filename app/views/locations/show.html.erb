<div id="carouselExample" class="carousel slide">
  <div class="carousel-inner">
    <% if @location.photos.attached? %>
      <% @location.photos.each_with_index do |photo, index| %>
        <div class="carousel-item <%= "active" if index.zero? %>">
          <%= cl_image_tag photo.key, class: "d-block w-100 rounded" %>
        </div>
      <% end %>
    <% else %>
      <div class="carousel-item active">
        <%= image_tag "daniel-brunsteiner-_jd5ryWK5J4-unsplash.jpg", class: "d-block w-100 rounded" %>
      </div>
    <% end %>
  </div>
  <% if @location.photos.length > 1 %>
    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExample" data-bs-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#carouselExample" data-bs-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Next</span>
    </button>
  <% end %>
</div>
<div class="d-flex ms-3 mt-3 mb-0 fw-bold sp">
  <h2><%= @location.name %></h2>
  <% if current_user&.favorited?(@location) %>
    <%= link_to unfavorite_location_path(@location), data: {turbo_method: :delete, turbo_confirm: "Remove #{@location.name} from favorites?"}, class: "text-center text-decoration-none text-white" do %>
      <div class="ms-3 mt-1">
        <i class="bi bi-heart-fill red-heart"></i>
      </div>
    <% end %>
  <% else %>
    <%= link_to favorite_location_path(@location), data: {turbo_method: :post, turbo_confirm: "Add #{@location.name} to favorites?" }, class: "text-center text-decoration-none text-white" do %>
      <div class="ms-3 mt-1">
        <i class="bi bi-heart-fill gray-heart"></i>
      </div>
    <% end %>
  <% end %>
</div>
<p class="ps-3 location-address">● <%= @location.category %></p>
<p class="ps-3 mb-0 location-address"><%= @location.address %></p>
<p class="ps-3 location-address">〒<%= @location.postal_code %></p>
<p class="amenity-title ms-3">Amenities:</p>
<% @location.amenities.each_slice(4) do |group| %>
  <div class="d-flex justify-content-center gap-4 flex-wrap">
    <div class="col"></div>
    <% group.each do |amenity| %>
      <div style="" class="amenity text-center col">
        <div class="amenity-icon rounded-circle d-flex align-items-center justify-content-center mx-auto">
          <i class="<%= amenity.icon_class %>"></i>
        </div>
        <div class=" amenity-label mt-2 justify-content-center">
          <%= amenity.key.humanize %>
        </div>
      </div>
    <% end %>
    <div class="col"></div>
  </div>
<% end %>
<div class="text-center"> <!-- break line -->
  <p>⸺⸺⸺⸺⸺⸺⸺⸺⸺⸺⸺</p>
</div>
<h3 class="ms-3 mt-3 mb-0 fw-bold">Reviews:</h3>
<% if @location.reviews.any? %>
  <div class="review-content-box d-flex align-items-center justify-content-center rounded-5 shadow">
    <!-- review display here -->
    <div class="ms-3 mt-2">
      <% @location.reviews.each do |review| %>
        <div class="review-content-box-user ms-2 mt-2 rounded-5 shadow p-2 pe-3">
          <p class="ms-3 mt-1 review-text-color-bold"><%= review.user.name %> :</p>
          <p class="ms-3 review-text-color">- <%= review.body %></p>
          <% if review.rating.present? %>
            <p class="ms-3 star-rating">
              <% review.rating.times do %>
                ★
              <% end %>
              <% (5 - review.rating).times do %>
                ☆
              <% end %>
            </p>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
<% else %>
  <p class="ms-3">No reviews for <%= @location.name %> yet :(</p>
<% end %>
<!-- Button trigger modal -->
<div class="ms-3 mt-3">
  <% if user_signed_in? && !@location.users.include?(current_user) && @location.owner != current_user %>
    <!-- Button trigger modal -->
    <button type="button" class="btn btn-button rounded-5 review-text-color-bold" data-bs-toggle="modal" data-bs-target="#exampleModal">
      Leave a review
    </button>
  <% elsif !user_signed_in? %>
    <%= link_to "Leave a review", new_user_session_path,
          class: "btn btn-info rounded-5",
          data: { turbo: false } %>
  <% end %>
</div>
<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">Review</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="bg-review container rounded-5 shadow card block">
          <h1 class="mt-3 fw-bold review-title">Leave a review for <%= @location.name %></h1>
          <div class="review-content">
            <%= simple_form_for [@location, @review] do |f| %>
              <%= f.input :body, label: "What did you think of #{@location.name}?" %>
              <%= f.input :rating, as: :radio_buttons, collection: 1..5, label: "Rating", item_wrapper_class: 'd-inline-block star-rating-put p-1' %>
              <%= f.button :submit , class: 'btn btn-button rounded-5 mt-3 mb-3 review-text-color-bold' %>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="text-center"> <!-- break line -->
  <p>⸺⸺⸺⸺⸺⸺⸺⸺⸺⸺⸺</p>
</div>
<p class="location-map ms-3">Map View: </p>
<!-- map display here -->
<div class="container">
  <div id="location-map"
       class="rounded-5 mb-5 w-100 mx-auto"
       style="height: 300px; max-width: 600px;"
       data-controller="mapbox"
       data-mapbox-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>"
       data-mapbox-lat-value="<%= @location.lat %>"
       data-mapbox-lng-value="<%= @location.lng %>"
       data-mapbox-name-value="<%= @location.name %>">
  </div>
</div>
<%# spacing so the map doesn't get covered by bottom nav bar %>
<div class="nav-bar-spacing"></div>
<div class="nav-bar-spacing"></div>
